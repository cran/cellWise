<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<title>cellwise weights examples</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.6.0/build/styles/github.min.css">
<script src="https://cdn.jsdelivr.net/combine/gh/highlightjs/cdn-release@11.6.0/build/highlight.min.js,npm/@xiee/utils/js/load-highlight.js" async></script>



<style type="text/css">
body, td {
  font-family: sans-serif;
  background-color: white;
  font-size: 13px;
}
body {
  max-width: 800px;
  margin: auto;
  padding: 1em;
  line-height: 1.5;
  box-sizing: border-box;
}
*, *:before, *:after {
  box-sizing: inherit;
}
tt, code, pre {
  font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}
a:visited { color: #80007f; }
pre, img { max-width: 100%; }
code {
  font-size: 92%;
  border: 1px solid #ccc;
}
code[class] { background-color: #F8F8F8; }
code.language-undefined { background-color: inherit; }
table {
  margin: auto;
  border-top: 1px solid #666;
  border-bottom: 1px solid #666;
}
table thead th { border-bottom: 1px solid #ddd; }
th, td { padding: 5px; }
thead, tfoot, tr:nth-child(even) { background: #eee; }
blockquote {
  color:#666;
  margin:0;
  padding-left: 1em;
  border-left: 0.5em #eee solid;
}
hr { border: 1px #ddd dashed; }
.frontmatter { text-align: center; }

@media print {
  * {
    background: transparent !important;
    color: black !important;
    filter:none !important;
  }
  body {
    font-size: 12pt;
    max-width: 100%;
  }
  a, a:visited { text-decoration: underline; }
  hr {
    visibility: hidden;
    page-break-before: always;
  }
  pre, blockquote {
    padding-right: 1em;
    page-break-inside: avoid;
  }
  tr, img { page-break-inside: avoid; }
  img { max-width: 100% !important; }
  @page :left { margin: 15mm 20mm 15mm 10mm; }
  @page :right { margin: 15mm 10mm 15mm 20mm; }
  p, h2, h3 { orphans: 3; widows: 3; }
  h2, h3 { page-break-after: avoid; }
}
</style>


</head>

<body>
<div class="include-before">

</div>

<div class="frontmatter">
<div class="title"><h1>cellwise weights examples</h1></div>
<div class="author"><h2>Rousseeuw, P.J.</h2></div>
<div class="date"><h3>2023-04-20</h3></div>
</div>

<div class="body">
<h1>Introduction</h1>
<p>This file contains examples of the use of the weightedEM, unpack, and cwLocScat functions. It reproduces all the figures of the report “Analyzing cellwise weighted data” by P.J. Rousseeuw.</p>
<pre><code class="language-r">library(&quot;cellWise&quot;)
n = 10
d = 3
A = matrix(0.7, d, d); diag(A) = 1
A
</code></pre>
<pre><code>##      [,1] [,2] [,3]
## [1,]  1.0  0.7  0.7
## [2,]  0.7  1.0  0.7
## [3,]  0.7  0.7  1.0
</code></pre>
<pre><code class="language-r">set.seed(12345)
library(&quot;MASS&quot;)
X = mvrnorm(n, rep(0,d), A)
colnames(X) = c(&quot;X1&quot;,&quot;X2&quot;,&quot;X3&quot;)
X[1,3] = X[2,2] = X[3,1] = X[4,1] = X[6,2] = NA
X # rows 1, 2, 3, 4, 6 have NAs
</code></pre>
<pre><code>##                X1         X2         X3
##  [1,]  0.81494704  0.5501005         NA
##  [2,]  1.57453449         NA  0.5526973
##  [3,]          NA -0.2420284  0.2337319
##  [4,]          NA -0.5869239  0.2996664
##  [5,] -0.24745384  0.9288529  0.9443676
##  [6,] -0.74023654         NA -2.0885170
##  [7,]  0.19707169  0.9746399  0.5190202
##  [8,] -0.06183274 -0.1193971 -0.5598499
##  [9,]  0.21050943 -0.7740109 -0.1989791
## [10,] -0.82944245 -0.9502024 -0.6871550
</code></pre>
<pre><code class="language-r">w = c(1,2,1,1,2,2,1,1,1,1) # rowwise weights
out = weightedEM(X,w,crit=1e-12,computeloglik=T)
out$niter # number of iteration steps taken
</code></pre>
<pre><code>## [1] 131
</code></pre>
<pre><code class="language-r">out$mu
</code></pre>
<pre><code>##          X1          X2          X3 
##  0.21182926 -0.28077406 -0.06154232
</code></pre>
<pre><code class="language-r">round(out$Sigma,6)
</code></pre>
<pre><code>##          X1       X2       X3
## X1 0.660288 0.331107 0.474936
## X2 0.331107 1.088924 0.943985
## X3 0.474936 0.943985 1.002466
</code></pre>
<pre><code class="language-r">plot(1:out$niter, out$loglikhd[1:out$niter], type='l',
     lty=1, col=4, xlab='step', ylab='log(likelihood)',
     main='log(likelihood) of weighted EM iterations')
</code></pre>
<img src="data:image/png;base64,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pJ8zJCAiAiLSooD0c44ERERARNoTkH7OkoCItCYg/ZwnAREREJG2BKSfMyUgIgIiIiAiLQlIP+dKQEQERERARAREREBE2hGQfs6WgIgIiIiAiAiIiICItCIg/ZwvAREREBEBEREQEQERaUNA+jljAiIiICICIiIgIgIi0oKA9HPOBEREQEQERERARARE5PQB6eesCYiIgIgIiIiAiAiIyMkD0s95ExARAREREBEBEREQEQERERARAREREJFTB6SfMycgIgIiIiAiAiIiICICIiIgIgIiIiAiAiIiICInDkg/505ARAREREBEBEREQEQERERARAREREBEBEREQEQEROS0Aenn7AmIiICICIiIgIgIiIiAiAiISBrQ/O3dcj4qiqv747cVUAc0EFDV0HL2+fHbCqgDGgho9uZ+NRMdu62AOiAOaHTxzdfVDPRm5zVMQH2QL6IXt8X1cnq5MwEJqBdOehSmn/MnICJNBfSqRbSAzp8ZiIiAiDQT0Oyz3YMwAfVCfh6oWNk9jhdQH8Qz0HxUpmMG6q0GXsLmo6vvNwMqHr24pYDOXyNroNlgz4loM1AvOAojIiAicUCzQTEc7zsIE1AvpAEtbm+W4+o47DWXcwjo/DVxSet0+LqfhemnA5qYgSqvmYEE1AENnEisCpq8Zg0koA445VGYgDpAQESaCWgyfM22AuoAAREREBFrICICIiIgIgIiIiAiAiJywoD00wUCIiIgIgIiIiAiAiIiICICIiIgIgIiIiAiAiIiICICInK6gPTTCQIiIiAiAiIiICICIiIgIgIiIiAiAiIiICICIiIgIgIiIiAiAiIiICICIiIgIgIicrKA9NMNAiIiICICIiIgIgIiIiAiAiIiICICIiIgIgIiIiAiAiIiICICIiIgIgIiIiAiAiIiICICIiIgIgIiIiAiAiJyqoD00xECIiIgIgIiIiAiAiIiICICIiIgIgIiIiAiAiIiICICIiIgIgIiIiAiAiIiICICIiIgIgIiIiAiAiIiICICInKigPTTFQIiIiAiAiIiICICIiIgIgIiIiAiAiIiICICIiIgIgIiIiAiAiIiICICIiIgIgIiIiAiAiIiICICIiIgIgIiIiAipwlIP50RBzQbFJXLu2O2FVBnpAEtbm/qX6dX90dsK6DOSAOav73b+vWwbQXUGWYgIvEaaD6yBuozR2FEBESkqYAsonvKDEREQESaOA9UHYjtHsULqBcaCKhe/sw+P2ZbAXVGAwHN3txbRPdWHNDo4puvqxnozfo1rHj0/q0E1Bn5InpxW1wvp85E95SjMCICItLEBWXDsR+m9lYTl3OMy3o2FtEHbCugzmjiROJ06DC+t5q6oMwM1FMNXFBWFTSxBuopR2FEBESkmYAmw+O2FVBnCIjISQLST3ecZA0koO4QEBEBEREQEQERERARAREREBEBEREQEQERERARAREREJHDAprW73W/aWpoAXXHIQFNi+vql8XtcQkJqA8OCGj+0/U7dv5l970XrxlaQN1hDUTkkBlo9PB5P3ve+/W6oQXUHYfNQOPqmufJdVNDC6g7Dgpo9cb3PW9/f+XQAuqOgwJa3NYz0J5PYn3d0ALqjsNewsoj+KI48hVMQL3gKIyIgIgc8RJ25BJIQL1wikW0fjrkFIfxAuoQMxCRU6yBBNQhpzgKE1CHCIiIlzAiFtFEHMYTMQMRsQYi4iiMiICIHPPGwqYuqhdQhxx2FPbFuyaHFlCHHHEY39jQAuqQw17C9v5TBq8eWkAdcoo3FgqoQxyFEREQkUNewt5+O/ISxn5mICICIuIojIgZiIiAiBx8PdDVD8f+QExAfXDoFYmzN/fThq5I1E+XHPrD1DKgpq6JFlCXHDEDNXVNtIC65ATXRAuoS05wFCagLjlsDfT31f8vvrYG4rnD3xc2uWjoMF5AXXLoGugng6MvShRQHxy6Bhoff1GrgPrgBD9MFVCXOAojIiAiJ7ikVUBdYgYiIiAijsKImIGIHDID/dX6Pxv5V5sF1CWHzEAN/7vxAuqSYz5g6qh8BNQP1kBEBETksAvKRq85jhdQHxw2A9UXc0yuj3tjj4D64IjPSJy//faoN/YIqA8Ov6R1Obn6/o0ZiG0HLqLH5Qroej5yHohnHIURERAR70wlctQi2nvjee6ow3jXA/GcGYiINRARR2FEBETERfVEPv4MpJ9OERARAREREBEBEREQEQERERARAREREBEBEREQEQERERARAREREBEBEREQEQERERARAREREBEBEREQEQERERARAREREBEBEREQkTSg6oMTq89/2fPxZQLqgwYCqj98c/b5odsKqFMaCGhW/Qsaez7CVUB9EAc0uvjm62oG2v13WATUB/kienFbXC+nez7+TkB94CiMiICINBWQRXRPmYGICIiIM9FEnIkm4kw0kQ9wJrp4tH8LAXWKM9FEHIURERCROKDZoBiO9/5bYgLqgzSgxe3NclzWc/DlHPrpliZOJE6HRxzGC6hbmpiBKmagnorXQPNRVdDk4DWQgLrlox+FCahbBESkmYAmw4O3FVC3CIiIgIhYAxEREBEBEREQEQERERARAREREBEBEREQEQERERARAREREBEBEREQEQERERARAREREBEBEREQEQERERARAREREBEBEREQEQERERARAREREBEBEREQEQERERARAREREBEBEfnYAemnYwREREBEBEREQEQERERARAREREBEBEREQEQERERARAREREBEBEREQEQERERARAREREBEBEREQEQERERARAREREBEBEREQEQERERARAREREBEBEREQEQERERARAREREBEBEREQEQERERARAREREBEBEREQEQERERARAREREBEBEREQEQEROQjB6SfrhEQEQERERARAREREBEBEREQEQERERARAREREBEBEREQEQERERARAREREBEBEREQEQERERARAREREBEBEREQEQERiQOaDYrK5d1B2wqoa9KAFrc39a/Tq/tDthVQ16QBzd/ebf36wrYC6hozEJF4DTQfWQP1maMwIgIi0lRAFtE9ZQYiIiAiDZyJvlncFsXuUbyAeqGJ80Djm7KjN84D9VIDZ6IXX72ziO6t+CWsnH6mw+Vyev20zaM9txZQ1+SL6HEdy/XuFwTUB47CiAiISBMXlA3HfpjaW40cxpf1OIzvqSYuKKuOwhzG91RTF5SZgXqqgQvKqoIm1kA95SiMiICINBPQZHjgtgLqGgERERARayAiAiIiICICIiIgIgIi8nED0k/nCIiIgIgIiIiAiAiIiICICIiIgIgIiIiAiAiIiICICIiIgIgIiIiAiAiIiICICIiIgIgIiIiAiAiIiICICIiIgIgIiIiAiAiIiICICIiIgIgIiIiAiAiIiICICIiIgIgIiIiAiAiIiICICIiIgIgIiIiAiAiIiICICIiIgIgIiIiAiAiIiICICIiIgIgIiIiAiAiIiICIfNSA9NM9AiIiICICIiIgIgIiIiAiAiIiICICIiIgIgIiIiAiAiIiICICIiIgIgIiIiAiAiIiICICIiIgIgIiIiAiAiIiICICIiIgIgIiIiAiH/fzgegcAREREBEBEREQEQERERARAREREBEBEREQEQERERARAREREBEBEREQEQERERARAREREBEBEREQEQERERARARH5kAHRBx8uoA8wUjO7055d6dr9+ZDDtuhetmdXunZ/PuSwLbqX7dmVrt2fDzlsi+5le3ala/fnQw7bonvZnl3p2v35kMO26F62Z1e6dn8+5LAtupft2ZWu3Z+PNix9ISAiAiIiICICIiIgIgIiIiAiAiIiICINBTQfFVf30QizQVHcNDDQ4jYeZXFbXLxLBynvz+VdOMjss6cRXj1QPUhTj+6uZgKqnrXJdTLC/It3y9mP3uUDTcoHKhxlfLOcXt1ng1T3ZxIOMq0SfBjh1QPVgzT26O5qJqD527tV6a82re7X+CYeaPbnX96Eu1NtvUzv0+zNfTVCMsj44h/LLR9GeO1Aq0GaenT3aCag+uEqK8+UI6QDLb76pvxblo0ye/Or6iUsG+RhBgr3pHyyH0Z4/UCPxTTw6O7TTEDljJ/v2eJ2GA80GVbTdDbKbFAnGO7KarkR7kk1eaxGeP1ADwE18eju054ZaD4axgOVmy8amIHCv/P1ID96t5xe3rVmBmri0d2rLWug+u99PNCkfiPTMFwD/bR+mLNBHv6yhwupfA20Pgpr4NHdq6mjsGG4vF/dwwYGqmagcJTxzWoqSwZ5mIHCQT67e7wvrx+onsaaenR3teU80GruuGnFeaBy6/gUTnn4nJ9Mauw8UGOP7i5nookIiIiAiAiIiICICIiIgIgIiIiAiAiIiICICIiIgIgIiIiAiAiIiICICIiIgIgIiIiADtX0+2E6QkCHEtBeAnrZtCgu7+r3+qze8DN/+5v6LTssBXSA6v2ck+t6BhrXb8ybj67up5fmo5qAXvTwbvLq/cXl76rPbBndLBdfmYJqAnrZbFB/3Mtn1StY9X7Tuqjxzal3qx0EdJDp1f3DJxwsV1OSGeiBgF40XX3Oz8MaqPzdfHRd/yFLAR1iXKw+rLA+CitfzOZf/MxR2CMBHa/pz2g6awI6noA2CIiIgIgIiIiAiAiIiICICIiIgIgIiIiAiAiIiICICIiIgIgIiIiAiPw/zI7DzYc7qOoAAAAASUVORK5CYII=" alt="plot of chunk unnamed-chunk-2" style="display: block; margin: auto;" />
<pre><code class="language-r">tail(out$loglikhd) # would have NAs for computeloglik=F
</code></pre>
<pre><code>## [1] -34.07189 -34.07189 -34.07189 -34.07189 -34.07189 -34.07189
</code></pre>
<pre><code class="language-r">out$impX # imputed data, has no NA's
</code></pre>
<pre><code>##                X1          X2         X3
##  [1,]  0.81494704  0.55010045  0.7764194
##  [2,]  1.57453449  0.01172782  0.5526973
##  [3,]  0.49065646 -0.24202836  0.2337319
##  [4,]  0.75818277 -0.58692386  0.2996664
##  [5,] -0.24745384  0.92885285  0.9443676
##  [6,] -0.74023654 -2.19170090 -2.0885170
##  [7,]  0.19707169  0.97463990  0.5190202
##  [8,] -0.06183274 -0.11939713 -0.5598499
##  [9,]  0.21050943 -0.77401094 -0.1989791
## [10,] -0.82944245 -0.95020238 -0.6871550
</code></pre>
<pre><code class="language-r"># The weights may be multiplied by a constant:
#
(w = c(1,2,1,1,2,2,1,1,1,1)/3) # divide weights by 3
</code></pre>
<pre><code>##  [1] 0.3333333 0.6666667 0.3333333 0.3333333 0.6666667 0.6666667 0.3333333
##  [8] 0.3333333 0.3333333 0.3333333
</code></pre>
<pre><code class="language-r">out = weightedEM(X,w,crit=1e-12,computeloglik=T)
out$niter # OK, same results:
</code></pre>
<pre><code>## [1] 131
</code></pre>
<pre><code class="language-r">out$mu # same
</code></pre>
<pre><code>##          X1          X2          X3 
##  0.21182926 -0.28077406 -0.06154232
</code></pre>
<pre><code class="language-r">round(out$Sigma,6) # same
</code></pre>
<pre><code>##          X1       X2       X3
## X1 0.660288 0.331107 0.474936
## X2 0.331107 1.088924 0.943985
## X3 0.474936 0.943985 1.002466
</code></pre>
<pre><code class="language-r">tail(out$loglikhd)
</code></pre>
<pre><code>## [1] -11.3573 -11.3573 -11.3573 -11.3573 -11.3573 -11.3573
</code></pre>
<pre><code class="language-r"># converges to -11.3573 = -34.07189 / 3


# Create an equivalent matrix y without weights, by repeating
# some rows according to their integer weights:
#
Y = X[c(1,2,2,3,4,5,5,6,6,7,8,9,10),]
dim(Y)
</code></pre>
<pre><code>## [1] 13  3
</code></pre>
<pre><code class="language-r">Y # This gives the same results:
</code></pre>
<pre><code>##                X1         X2         X3
##  [1,]  0.81494704  0.5501005         NA
##  [2,]  1.57453449         NA  0.5526973
##  [3,]  1.57453449         NA  0.5526973
##  [4,]          NA -0.2420284  0.2337319
##  [5,]          NA -0.5869239  0.2996664
##  [6,] -0.24745384  0.9288529  0.9443676
##  [7,] -0.24745384  0.9288529  0.9443676
##  [8,] -0.74023654         NA -2.0885170
##  [9,] -0.74023654         NA -2.0885170
## [10,]  0.19707169  0.9746399  0.5190202
## [11,] -0.06183274 -0.1193971 -0.5598499
## [12,]  0.21050943 -0.7740109 -0.1989791
## [13,] -0.82944245 -0.9502024 -0.6871550
</code></pre>
<pre><code class="language-r">out = weightedEM(Y,crit=1e-12,computeloglik=T) # OK, same
out$niter
</code></pre>
<pre><code>## [1] 131
</code></pre>
<pre><code class="language-r">out$mu
</code></pre>
<pre><code>##          X1          X2          X3 
##  0.21182926 -0.28077406 -0.06154232
</code></pre>
<pre><code class="language-r">round(out$Sigma,6)
</code></pre>
<pre><code>##          X1       X2       X3
## X1 0.660288 0.331107 0.474936
## X2 0.331107 1.088924 0.943985
## X3 0.474936 0.943985 1.002466
</code></pre>
<pre><code class="language-r">tail(out$loglikhd)
</code></pre>
<pre><code>## [1] -34.07189 -34.07189 -34.07189 -34.07189 -34.07189 -34.07189
</code></pre>
<pre><code class="language-r"># converges to -34.07189 like before.
</code></pre>
<h1>Unpack the toy example in section 2 of the paper</h1>
<pre><code class="language-r">X = matrix(c(2.8,5.3,4.9,7.4,
             2.3,5.7,4.3,7.2,
             2.5,5.1,4.4,7.6),nrow=3,byrow=T)
W = matrix(c(0.8,1.0,0.3,0.4,
             0.3,0.5,0.9,0.5,
             1.0,0.6,0,0.7),nrow=3,byrow=T)
rownames(X) = rownames(W) = c(&quot;A&quot;,&quot;B&quot;,&quot;C&quot;)
colnames(X) = colnames(W) = c(&quot;V1&quot;,&quot;V2&quot;,&quot;V3&quot;,&quot;V4&quot;)
n = nrow(X); d = ncol(X)
X
</code></pre>
<pre><code>##    V1  V2  V3  V4
## A 2.8 5.3 4.9 7.4
## B 2.3 5.7 4.3 7.2
## C 2.5 5.1 4.4 7.6
</code></pre>
<pre><code class="language-r">W
</code></pre>
<pre><code>##    V1  V2  V3  V4
## A 0.8 1.0 0.3 0.4
## B 0.3 0.5 0.9 0.5
## C 1.0 0.6 0.0 0.7
</code></pre>
<pre><code class="language-r">out = unpack(X,W)
cbind(out$U,out$v) # OK
</code></pre>
<pre><code>##    V1  V2  V3  V4    
## A  NA 5.3  NA  NA 0.2
## A 2.8 5.3  NA  NA 0.4
## A 2.8 5.3  NA 7.4 0.1
## A 2.8 5.3 4.9 7.4 0.3
## B  NA  NA 4.3  NA 0.4
## B  NA 5.7 4.3 7.2 0.2
## B 2.3 5.7 4.3 7.2 0.3
## C 2.5  NA  NA  NA 0.3
## C 2.5  NA  NA 7.6 0.1
## C 2.5 5.1  NA 7.6 0.6
</code></pre>
<pre><code class="language-r">dim(out$U)
</code></pre>
<pre><code>## [1] 10  4
</code></pre>
<h1>Playing with the function cwLocScat</h1>
<pre><code class="language-r">set.seed(12345)
n = 1000; d = 2
A = matrix(0.7, d, d); diag(A) = 1
A
</code></pre>
<pre><code>##      [,1] [,2]
## [1,]  1.0  0.7
## [2,]  0.7  1.0
</code></pre>
<pre><code class="language-r">X = mvrnorm(n, rep(0,d), A)
head(X)
</code></pre>
<pre><code>##            [,1]       [,2]
## [1,] -0.1098666  1.1895284
## [2,]  0.6233152  0.6848755
## [3,]  0.2309203 -0.4324656
## [4,] -0.1164846 -0.7197229
## [5,]  0.7061365  0.4110647
## [6,] -0.9412289 -2.4109163
</code></pre>
<pre><code class="language-r">W = abs(mvrnorm(n, rep(0,d), diag(rep(1,2))))
W = W/max(as.vector(W))
W[2,1] = 0
W[5,2] = 0
head(W)
</code></pre>
<pre><code>##             [,1]       [,2]
## [1,] 0.151856434 0.18102767
## [2,] 0.000000000 0.32052154
## [3,] 0.120772713 0.17167154
## [4,] 0.003729069 0.32719369
## [5,] 0.327865177 0.00000000
## [6,] 0.285126341 0.01091696
</code></pre>
<pre><code class="language-r">fit = cwLocScat(X,W)
fit$cwMLEiter # number of iteration steps
</code></pre>
<pre><code>## [1] 47
</code></pre>
<pre><code class="language-r">fit$cwMLEmu
</code></pre>
<pre><code>##          1          2 
## 0.05972004 0.04231900
</code></pre>
<pre><code class="language-r">fit$cwMean
</code></pre>
<pre><code>##          1          2 
## 0.06657723 0.03736100
</code></pre>
<pre><code class="language-r">fit$cwMLEsigma
</code></pre>
<pre><code>##           1         2
## 1 0.9717504 0.6735339
## 2 0.6735339 1.0075136
</code></pre>
<pre><code class="language-r">fit$cwCov # similar to cwMLEsigma:
</code></pre>
<pre><code>##           1         2
## 1 0.9759485 0.7398607
## 2 0.7398607 1.0299615
</code></pre>
<pre><code class="language-r">fit$sqrtCov # same diagonal:
</code></pre>
<pre><code>##           1        2
## 1 0.9759485 0.718826
## 2 0.7188260 1.029961
</code></pre>
<h1>Personality traits example from section 4</h1>
<pre><code class="language-r">data(&quot;data_personality_traits&quot;)
X &lt;- data_personality_traits$X
W &lt;- data_personality_traits$W
cbind(X,W) # as in table in the paper
</code></pre>
<pre><code>##         t1 t2   t3   t4   t5   t6   t1   t2   t3   t4   t5   t6
##  [1,]  7.0  5  7.0  5.0  5.0  5.0 0.50 0.29 0.50 0.29 0.29 0.29
##  [2,] 10.0 10 10.0  7.0  8.5  7.0 1.00 1.00 1.00 0.50 0.58 0.50
##  [3,]  5.0  5 10.0  5.0  5.0  5.0 0.29 0.29 1.00 0.29 0.29 0.29
##  [4,] 10.0 10 10.0  5.0  5.0  5.0 1.00 1.00 1.00 0.29 0.29 0.29
##  [5,]  7.0  7  8.5  5.0  5.0  5.0 0.50 0.50 0.58 0.29 0.29 0.29
##  [6,] 10.0  5  5.0  8.5  8.5  5.0 1.00 0.29 0.29 0.58 0.58 0.29
##  [7,]  5.0  7  7.0  5.0  5.0  8.5 0.29 0.50 0.50 0.29 0.29 0.58
##  [8,] 10.0 10 10.0 10.0 10.0 10.0 1.00 1.00 1.00 1.00 1.00 1.00
##  [9,]  8.5  7  8.5  5.0  5.0  5.0 0.58 0.50 0.58 0.29 0.29 0.29
## [10,]  5.0 10  5.0  7.0  5.0  7.0 0.29 1.00 0.29 0.50 0.29 0.50
</code></pre>
<pre><code class="language-r">out = unpack(X,W)
cbind(out$U,out$v)
</code></pre>
<pre><code>##      t1 t2   t3   t4   t5   t6     
## 1   7.0 NA  7.0   NA   NA   NA 0.21
## 1   7.0  5  7.0  5.0  5.0  5.0 0.29
## 2  10.0 10 10.0   NA   NA   NA 0.42
## 2  10.0 10 10.0   NA  8.5   NA 0.08
## 2  10.0 10 10.0  7.0  8.5  7.0 0.50
## 3    NA NA 10.0   NA   NA   NA 0.71
## 3   5.0  5 10.0  5.0  5.0  5.0 0.29
## 4  10.0 10 10.0   NA   NA   NA 0.71
## 4  10.0 10 10.0  5.0  5.0  5.0 0.29
## 5    NA NA  8.5   NA   NA   NA 0.08
## 5   7.0  7  8.5   NA   NA   NA 0.21
## 5   7.0  7  8.5  5.0  5.0  5.0 0.29
## 6  10.0 NA   NA   NA   NA   NA 0.42
## 6  10.0 NA   NA  8.5  8.5   NA 0.29
## 6  10.0  5  5.0  8.5  8.5  5.0 0.29
## 7    NA NA   NA   NA   NA  8.5 0.08
## 7    NA  7  7.0   NA   NA  8.5 0.21
## 7   5.0  7  7.0  5.0  5.0  8.5 0.29
## 8  10.0 10 10.0 10.0 10.0 10.0 1.00
## 9   8.5 NA  8.5   NA   NA   NA 0.08
## 9   8.5  7  8.5   NA   NA   NA 0.21
## 9   8.5  7  8.5  5.0  5.0  5.0 0.29
## 10   NA 10   NA   NA   NA   NA 0.50
## 10   NA 10   NA  7.0   NA  7.0 0.21
## 10  5.0 10  5.0  7.0  5.0  7.0 0.29
</code></pre>
<pre><code class="language-r">fit = cwLocScat(X,W)
fit$cwMLEiter
</code></pre>
<pre><code>## [1] 49
</code></pre>
<pre><code class="language-r">round(fit$cwMLEmu,2)
</code></pre>
<pre><code>##   t1   t2   t3   t4   t5   t6 
## 8.82 8.72 8.98 7.40 7.53 7.37
</code></pre>
<pre><code class="language-r">round(fit$cwMean,2)
</code></pre>
<pre><code>##   t1   t2   t3   t4   t5   t6 
## 8.73 8.61 8.87 7.09 7.16 7.09
</code></pre>
<pre><code class="language-r">round(fit$cwMLEsigma, 2)
</code></pre>
<pre><code>##      t1   t2   t3   t4   t5   t6
## t1 3.22 1.83 1.49 1.91 2.52 1.02
## t2 1.83 3.49 1.55 1.69 1.82 2.00
## t3 1.49 1.55 2.50 0.63 1.22 0.92
## t4 1.91 1.69 0.63 3.54 3.48 2.84
## t5 2.52 1.82 1.22 3.48 3.90 2.82
## t6 1.02 2.00 0.92 2.84 2.82 3.58
</code></pre>
<pre><code class="language-r">round(eigen(fit$cwMLEsigma)$values, 2)
</code></pre>
<pre><code>## [1] 13.13  3.24  2.18  1.25  0.31  0.11
</code></pre>
<pre><code class="language-r">round(fit$cwCov, 2)
</code></pre>
<pre><code>##      t1   t2   t3   t4   t5   t6
## t1 3.36 2.10 1.72 2.63 3.33 1.37
## t2 2.10 3.61 1.78 2.20 2.44 2.46
## t3 1.72 1.78 2.59 0.81 1.64 1.14
## t4 2.63 2.20 0.81 3.99 4.17 3.26
## t5 3.33 2.44 1.64 4.17 4.76 3.40
## t6 1.37 2.46 1.14 3.26 3.40 4.00
</code></pre>
<pre><code class="language-r">round(eigen(fit$cwCov)$values,5)
</code></pre>
<pre><code>## [1] 15.91356  2.99031  2.26943  1.08606  0.05570  0.00416
</code></pre>
<pre><code class="language-r">round(cov(X), 2) # unweighted
</code></pre>
<pre><code>##      t1   t2    t3    t4   t5   t6
## t1 4.96 1.61  1.44  2.01 3.00 0.07
## t2 1.61 4.93  1.38  1.39 1.26 2.17
## t3 1.44 1.38  4.04 -0.42 0.59 0.36
## t4 2.01 1.39 -0.42  3.29 3.25 1.93
## t5 3.00 1.26  0.59  3.25 3.90 1.89
## t6 0.07 2.17  0.36  1.93 1.89 3.29
</code></pre>
<pre><code class="language-r">round(eigen(cov(X))$values, 2)
</code></pre>
<pre><code>## [1] 11.97  4.95  4.64  2.28  0.47  0.10
</code></pre>
<p>Now we reproduce the figure in the paper</p>
<pre><code class="language-r">ellips = function(covmat, mu, quant=0.95, npoints = 120)
{ # computes points of the ellipse t(X-mu)%*%covmat%*%(X-mu) = c
  # with c = qchisq(quant,df=2)
  if (!all(dim(covmat) == c(2, 2))) stop(&quot;covmat is not 2 by 2&quot;)
  eig = eigen(covmat)
  U = eig$vectors
  R = U %*% diag(sqrt(eig$values)) %*% t(U) # square root of covmat
  angles = seq(0, 2*pi, length = npoints+1)
  xy = cbind(cos(angles),sin(angles)) # points on the unit circle
  fac = sqrt(qchisq(quant, df=2))
  scale(fac*xy%*%R, center = -mu, scale=FALSE)
}  


n = nrow(X)
j = 3; k = 6 # to plot variables t3 and t6
xy = X[,c(j,k)]
cov2cor(cov(X)[c(j,k),c(j,k)]) # unweighted correlation is 0.10
</code></pre>
<pre><code>##            t3         t6
## t3 1.00000000 0.09896998
## t6 0.09896998 1.00000000
</code></pre>
<pre><code class="language-r">cov2cor(fit$cwMLEsigma[c(j,k),c(j,k)]) # now correlation is 0.31
</code></pre>
<pre><code>##           t3        t6
## t3 1.0000000 0.3077506
## t6 0.3077506 1.0000000
</code></pre>
<pre><code class="language-r">(wxy = W[,c(j,k)])
</code></pre>
<pre><code>##         t3   t6
##  [1,] 0.50 0.29
##  [2,] 1.00 0.50
##  [3,] 1.00 0.29
##  [4,] 1.00 0.29
##  [5,] 0.58 0.29
##  [6,] 0.29 0.29
##  [7,] 0.50 0.58
##  [8,] 1.00 1.00
##  [9,] 0.58 0.29
## [10,] 0.29 0.50
</code></pre>
<pre><code class="language-r">duplicated(xy) # ties: row 4 equals row 3, and row 9 equals row 5
</code></pre>
<pre><code>##  [1] FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE  TRUE FALSE
</code></pre>
<pre><code class="language-r">wxy[3,] = wxy[3,] + wxy[4,] # add cell weights of rows 3 and 4
wxy[5,] = wxy[5,] + wxy[9,] # add cell weights of rows 5 and 9
(wxy = wxy[-c(4,9),]) # remove duplicate rows
</code></pre>
<pre><code>##        t3   t6
## [1,] 0.50 0.29
## [2,] 1.00 0.50
## [3,] 2.00 0.58
## [4,] 1.16 0.58
## [5,] 0.29 0.29
## [6,] 0.50 0.58
## [7,] 1.00 1.00
## [8,] 0.29 0.50
</code></pre>
<pre><code class="language-r">(xy = xy[-c(4,9),]) # remove duplicate rows
</code></pre>
<pre><code>##        t3   t6
## [1,]  7.0  5.0
## [2,] 10.0  7.0
## [3,] 10.0  5.0
## [4,]  8.5  5.0
## [5,]  5.0  5.0
## [6,]  7.0  8.5
## [7,] 10.0 10.0
## [8,]  5.0  7.0
</code></pre>
<pre><code class="language-r"># pdf(&quot;personality_cwMLE_cwCov.pdf&quot;,width=5.5,height=5.5)
myxlim = c(2,14); myylim = c(1,13)
plot(xy, pch=16, col=&quot;white&quot;, xlim=myxlim, ylim=myylim,
     xlab=&quot;&quot;,ylab=&quot;&quot;)
fac = 0.3 # for the size of the lines representing the cell weights
for(i in seq_len(nrow(xy))){
  WY = c(xy[i,1] - fac*wxy[i,1],xy[i,2]) # (WestX, Y) 
  EY = c(xy[i,1] + fac*wxy[i,1],xy[i,2]) # (EastX, Y) 
  XS = c(xy[i,1],xy[i,2] - fac*wxy[i,2]) # (X, SouthY)
  XN = c(xy[i,1],xy[i,2] + fac*wxy[i,2]) # (X, NorthY)
  lines(rbind(WY,EY),lwd=3)
  lines(rbind(XS,XN),lwd=3)
}
title(main=&quot;tolerance ellipses with and without cell weights&quot;,
      line=0.8,cex.main=1) # 1.2)
title(xlab=&quot;trait 3&quot;,line=2.1,cex.lab=1.0)
title(ylab=&quot;trait 6&quot;,line=2.1,cex.lab=1.0)
center1 = colMeans(X[,c(j,k)])
covmat1 = (n-1)*cov(X[,c(j,k)])/n                   
ell1 = ellips(covmat1, center1)
lines(ell1,lwd=1.5,col=&quot;red&quot;) # ellipse from unweighted covariance
fit2 = cwLocScat(xy,wxy)
center2 = fit2$cwMLEmu
covmat2 = fit2$cwMLEsigma
ell2 = ellips(covmat2, center2) # ellipse from cwMLE estimates
lines(ell2,lwd=1.5,col=&quot;blue&quot;)
center3 = fit2$cwMean
covmat3 = fit2$cwCov
ell3 = ellips(covmat3, center3) # ellipse from cwMean and cwCov
lines(ell3,lwd=1.5,lty=2,col=&quot;blue&quot;)
legend(&quot;topleft&quot;,c(&quot;cwMLE&quot;,&quot;cwCov&quot;,&quot;MLE&quot;),
       col=c(&quot;blue&quot;,&quot;blue&quot;,&quot;red&quot;), lty=c(1,2,1), lwd=1.5, cex=1)
</code></pre>
<img src="data:image/png;base64,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" alt="plot of chunk unnamed-chunk-6" style="display: block; margin: auto;" />
<pre><code class="language-r"># dev.off()

# The blue ellipses, that use the cell weights, are a bit
# higher and more slanted than the red ellipse that doesn't,
# mainly due to the high cell weight of the y-coordinate of 
# the point in the top right corner.
</code></pre>

</div>

<div class="include-after">

</div>

<script src="https://cdn.jsdelivr.net/combine/npm/@xiee/utils/js/center-img.min.js" async></script>
<script>

</script>
</body>

</html>
